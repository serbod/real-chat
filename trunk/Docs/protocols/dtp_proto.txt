Термины:

* Точка - участник сети

* Клиент - точка, способная подключаться к узлам, но не способная 
принимать входящие подключения.

* Узел - точка, способная подключаться к другим узлам и принимать входищие 
подключения.

* Аплинк - узел, к которому подключена точка. Если сама точка является узлом, 
то аплинк - это вышестоящий узел.

* Список аплинков - список известных точке узлов, к которым она может 
подключиться.

* ИД - идентификатор точки (4 байта). У всех узлов должны быть уникальные 
идентификаторы. У клиентов идентификаторы уникальны только в пределах аплинка.

* ПолныйИД - ИД и ИД аплинка (8 байтов)

* Таблица маршрутов - расширеный список аплинков, содержащий узлы, которые 
подключены к данному аплинку.

* Сообщение - пакет данных, содержащий информацию об отправителе, получателе,
типе сообщения, заголовок, текст, служебную информацию. Передается между 
узлами от отправителя до получателя по правилам маршрутизации.

* Синбаи - служебная информация сообщения, список полных ИД точек, которые 
видели сообщение. Служит для отслеживания маршрута сообщения и предотвращения 
повторной пересылки.

* Черный список клиентов - список клиентов-нарушителей, хранимый на узле. 
Клиенты из этого списка имеют ограниченые возможности по отправке сообщений.

* Черный список узлов - список узлов-нарушителей, хранимый на узле. 
Подключения или прием сообщений с этих узлов ограничены.

* Канал - признак сообщения. Канал имеет название, начинающееся с символа # 
(решетка) и не содержащее пробелов. Сообщение на канал получают все точки, у 
которых этот канал в списке активных каналов. Сообщения на канал передаются 
сразу же после получения и не хранятся.

* Форум - признак сообщения. Форум имеет название, не содержащее пробелов. 
Сообщение на форум получают все точки, подписаные на него. Узлы хранят 
некоторое количество сообщений форумов.

* Список доступных каналов - список доступных на узле каналов

* Список активных каналов - список каналов, которые использует узел и его 
клиенты.

Схема работы:

Сеть состоит из узлов и клиентов. Узлы могут принимать входящие подключения, 
клиенты не могут. Каждый узел имеет уникальный среди других узлов ИД. Каждый 
клиент имеет ИД, уникальный среди других клиентов своего аплинка.

При подключении точки к аплинку происходит опознание точки на аплинке. 
Неопознаная точка регистрируется, если это клиент, то ему присваивается ИД. 
После опознания происходит обмен известными узлами, обновление таблиц 
маршрутов.

При отправке сообщения, точка указывает



1. Подключение

< Сервер:
ИД, инфо о себе, рандомный хеш (ключ опознания)

> Клиент:
ИД, инфо о себе, хеш своего ключа по ключу сервера

< Сервер:
результат опознания
 Если клиент известен:
  Хеширует ключ клиента ключом опознания, сравнивает результаты

 Если клиент неизвестен, то ключ опознания становится ключом клиента.


2. Обмен узлами

< Сервер:
список известных ему узлов

> Клиент:
список известных ему узлов, кроме узлов, известных серверу


3. Смена узла-аплинка
Клиент пингует известные ему узлы и выбирает самый "ближний".
Клиент подключается к выбраному узлу.
Если успешно, то отключается от прежнего узла.

4. Сообщение
ИД
