[b]1. Принцип работы плагинов.[/b]

[b]1.1. Виды плагинов и способы связи[/b]

Плагином может быть любой исполнимый файл, способный работать со стандартным 
вводом-выводом (STDIO). Прием сообщений через STDIN, отправка через STDOUT.

Плагином может быть динамически подключаемая библиотека DLL, тогда обмен 
сообщениями идет через пайп (pipe) или через пару функций приема-передачи 
сообщений.

Связь основного окна чата с плагинами осуществляется с помощью текстовых 
сообщений, по образу и подобию командной строки операционных систем. Сообщение 
содержит команду и параметры. Параметры разделяются пробелами, если параметр 
содержит пробелы, то он заключается в двойные кавычки: "парметр с пробелом". 
Если параметр содержит двойную кавычку, то она дублируется:
 "параметр с ""кавычками""". Числовые значения передаются в 
строковом виде, например: 1234 (десятичное).


[b]1.2 Плагин DLL с передачей сообщений через функции[/b]

[b]1.2.1. Начало работы плагина.[/b]

После загрузки плагина чат запускает функцию инициализации плагина:

[code]function Init(MainWnd, CfgWnd, MainCmdFunc: DWord):DWord; stdcall;[/code]

MainWnd - handle главного окна чата
CfgWnd - handle окна настроек
MainCmdFunc - адрес функции передачи команд из плагина в чат (описание функции 
см. ниже).

После инициализации функция возвращает код результата. 0 - все в порядке, 
иначе код ошибки.


[b]1.2.2. Передача данных из чата в плагин.[/b]

Команды плагину передаются через функцию:

[code]function CmdFunc(Cmd:PChar):PChar; stdcall;[/code]

В качестве параметра ей передается строка с командой и параметрами.


[b]1.2.3. Передача данных из плагина в чат.[/b]

Передача команд из плагина в главное окно осуществляется через аналогичную 
функцию, адрес которой передается при инициализации плагина.

[code]function MainCmdFunc(Cmd:PChar):PChar; stdcall;[/code]

Принцип работы тот же, что у функции CmdFunc().


[b]1.2.4. Завершение работы плагина.[/b]

Перед выгрузкой плагина чат запускает функцию плагина:

[code]function Outit():DWord; stdcall;[/code]

В ней плагин должен остановить свою работу и вернуть код результата. 0 - все в 
порядке, иначе код ошибки.



[b]2. Описание команд, передаваемых из чата в плагин.[/b]

Реализованые команды выделены [sea][b]синим цветом[/sea][/b]


[b]2.1. Основные команды плагину[/b]

[sea][b]GET_ABOUT[/sea][/b]
  запрос информации о плагине и его авторе.

[sea][b]GET_VERSION[/sea][/b]
  запрос версии плагина.

[sea][b]START[/sea][/b]
  сигнал начала работы плагина

[sea][b]QUIT[/sea][/b]
  завершение работы плагина

GET_CMD_LIST
  запрос списка команд (разделенных пробелами), которые понимает плагин.

GET_HELP [имя раздела]
  запрос справки по использованию плагина.


[b]2.2. Информационные сообщения[/b]

[sea][b]ACTIVE_PAGE <ID страницы>[/b][/sea]
  сообщает ID текущей страницы при изменении текущей страницы или по запросу
  GET_ACTIVE_PAGE

ACTIVE_PAGE_NAME <имя закладки>
  сообщает заголовок текущей закладки

[sea][b]PAGES_ID <список ID страниц>[/b][/sea]
  Список ID страниц, разделенный пробелами

[sea][b]NEW_PAGE <ID страницы> <имя закладки>[/b][/sea]
  сообщает о создании новой страницы

[sea][b]PAGE_INFO <ID страницы> <имя закладки> <тип страницы> <видимость>[/b][/sea]
  сообщает информацию о странице по запросу GET_PAGE_INFO

[sea][b]MAIN_OPTIONS <настройки>[/b][/sea]
  Переменные глобальных настроек в виде списка имя=значение, 
  разделенного пробелами. Передаются по запросу GET_MAIN_OPTIONS.

[sea][b]OPTIONS <настройки>[/b][/sea]
  Переменные настроек плагина в виде списка имя=значение, 
  разделенного пробелами. Передаются по запросу GET_OPTIONS.

[sea][b]OPTIONS_PANEL_HANDLE <handle>[/b][/sea]
  сообщает handle панели опций плагина в окне настроек, только если при
  создании узла настроек CREATE_PLUGIN_NODE плагина было задано имя панели

[b]2.3. События компонентов[/b]

[sea][b]IRC <имя соединения> <команда> <отправитель> <число параметров> [параметры] [сообщение][/b][/sea]
  сообщение от встроенного IRC-клиента

[sea][b]ICHAT <имя соединения> <команда> <отправитель> <число параметров> [параметры][/b][/sea]
  сообщение от встроенного iChat-клиента


[b]2.4. События интерфейса пользователя[/b]

RESIZE
  сообщает об изменении размера окна чата

CONNECT
  сообщает о том, что надо подключиться

DISCONNECT
  сообщает о том, что надо отключиться

[sea][b]OPTIONS_CHANGED[/b][/sea]
  сообщает о том, что настройки изменились

[sea][b]USER_SAY <ID страницы> <текст сообщения>[/b][/sea]
  сообщает о том, что пользователь ввел какой-то текст

USER_KEYPRESS <ID страницы> <код нажатой клавиши>
  сообщает о том, что пользователь нажал клавишу

USER_MOUSE_CLICK <ID страницы> <X> <Y> <код кнопки мыши>
  сообщает, что юзер кликнул мышью

TIMER_TICK
  событие таймера



[b]3. Описание команд, передаваемых из плагина в чат[/b]

Реализованые команды выделены [sea][b]синим цветом[/sea][/b]


[b]3.1. Информационные сообщения[/b]

[sea][b]VERSION <строка>[/b][/sea]
  Сообщает версию плагина, 

[sea][b]ABOUT <строка>[/b][/sea]
  Сообщает информацию о плагине и его авторе

HELP <текст>
  Сообщает информацию об использовании плагина

[sea][b]CMD_LIST <текст>[/b][/sea]
  Сообщает список команд, которые поддерживаются плагином. Команды в списке 
  разделены пробелами.

[sea][b]// <текст>[/b][/sea]
  Комментарий, игнорируется.


[b]3.2. Команды обмена настройками[/b]

[sea][b]GET_MAIN_OPTIONS[/b][/sea]
  Получить переменные глобальных настроек в виде списка имя=значение, 
  разделенного пробелами

[sea][b]SET_MAIN_OPTIONS <список переменных>[/b][/sea]
  Установить глобальные переменные, переданные в списке

[sea][b]GET_OPTIONS[/b][/sea]
  Получить переменные настроек плагина в виде списка имя=значение, 
  разделенного пробелами

[sea][b]SET_OPTIONS <список переменных>[/b][/sea]
  Установить переменные плагина, переданные в списке

[sea][b]CREATE_PLUGIN_NODE <имя узла> <имя файла настроек> [имя панели настроек][/b][/sea]
  Создаем страницу плагина в окне натроек. Если указано имя панели настроек,
  то создается пустая панель для настроек плагина и возвращается ее handle.
  Имя панели любое.

[sea][b]ADD_CONF_ITEM <имя> <тип> <полное имя> <значение>[/b][/sea]
  Добавляет опцию настройки плагина в список настроек
  имя: без пробелов
  тип: S-строка, N-число, B-булево (0 или 1), T-текст с разделителями строк


[b]3.3. Команды работы со страницами чата (закладками)[/b]

[c=2][b]GET_ACTIVE_PAGE[/b][/c]
  Получение ID текущей активной закладки

GET_ACTIVE_PAGE_NAME
  Получение заголовка активной закладки

[c=2][b]SET_ACTIVE_PAGE <ID страницы> [номер панели закладок][/b][/c]
  Установка страницы активной.

[c=2][b]GET_PAGES_ID[/b][/c]
  Получение списка ID страниц, разделенный пробелами

[c=2][b]GET_PAGE_ID <имя закладки> [номер панели закладок][/b][/c]
  Получение ID страницы по имени закладки. Результат в PAGES_ID

GET_PAGE_HANDLE <имя закладки> [номер панели закладок]
  Получение handle окна старницы по имени закладки

GET_PAGESPACE_HANDLE <номер панели закладок>
  Возвращает handle панели закладок

[c=2][b]GET_PAGE_INFO <ID страницы>[/b][/c]
  Возвращает информацию о странице по ее ID

CLEAR_PAGE <ID страницы> [номер панели закладок]
  Очищает заданую страницу

CREATE_PAGE <имя закладки> [номер панели закладок]
  Создание новой страницы. В параметре имя закладки. Возвращает ID страницы

CREATE_CHAT_PAGE <название закладки>
  Создает страницу чата с указаным именем, возвращает ее ID

CREATE_PRIVATE_PAGE <имя закладки> [номер панели закладок]
  Создать страницу для приватных сообщений

DELETE_PAGE <ID страницы>
  Удалить страницу чата

[b]3.4. Команды для работы с окном чата[/b]

[color=2][b]DEBUG_MSG <текст>[/b][/color]
  Отладочное сообщение, отображается в окне событий

[color=2][b]PUT_IRC_TEXT <ID страницы> <текст> [номер панели закладок][/b][/color]
  Вставка текста в окно, через парсер IRC-цветов.

SAY_IRC_MANUAL <текст>
  Отправка текста так, как если бы мы его руками ввели в окно

SAY_IRC_DIRECT <текст> [SHOW] [PARSE]
  Прямая отправка на сервер IRC без какого-либо вмешательства
  SHOW - показать текст в текущем окне
  PARSE - разбирать форматирование и цвета IRC

DRAW_HTML <ID страницы> <текст> [номер панели закладок]
  Вставка текста в окно через парскр тегов HTML

GET_BTN_TOOLBAR_HANDLE <номер закладки> [номер панели закладок]
  Получить handle панели кнопок внутри закладки чата

GET_TYPED_TEXT
  Получить набраный в поле ввода сообщения текст

SET_TYPED_TEXT <текст>
  Установить текст в поле ввода сообщения

INSERT_CHAR <буква>
  Вставляет букву в поле ввода текущей закладки

[b]3.5. Команды для работы со списком юзеров[/b]

CREATE_NICK_LIST <ID страницы> <список ников> [номер панели закладок]
  Заполнить список ников для заданной страницы

ADD_NICK_TO_LIST <ID страницы> <ник> [номер панели закладок]
  Добавить ник в список

ADD_NICK_TO_GROUP <ID страницы> <ник> <имя группы> [номер панели закладок]
  Добавляет ник в заданную группу

DELETE_NICK_FROM_LIST <ID страницы> <ник> [номер панели закладок]
  Удалить ник из списка

DELETE_NICK_FROM_GROUP <ID страницы> <имя группы> <ник> [номер панели закладок]
  Удаляет ник из указанной группы

REPLACE_NICK <ID юзера> <новый ник> [ID страницы]
  Меняет ник юзера. Если закладка не указана - то на всех

GET_NICK_NUMBER <ID страницы> <ник> [номер панели закладок]
  Возвращает номер ника из списка в указаной закладке

CLEAR_USERLIST <ID страницы>
  Очищает список юзеров для указаной закладки

[b]3.6. Прочие команды[/b]

FLASH_ICON <заголовок> <текст> [опции показа]
  Включить мигание значка в трее и указать всплывающее сообщение.

STOP_ICON_FLASH
  Отключить мигание значка в трее

GET_SELECTED_TEXT_USER_LIST
  ???

CHANGE_TEXT_WINDOW <ID закладки> [номер панели закладок]
  Показывает окно ??? для указаной закладки

SHOW_COLORS_WINDOW <ID закладки> [номер панели закладок]
  Показывает окно выбора цвета для указаной закладки

GET_PLUGIN_ID <имя плагина>
  Возвращает ID плагина

LOAD_ICON <имя файла> [имя значка в файле]
  Загружает значок из указаного файла. Возвращает ID значка.

SET_PROTOCOL_ICON <ID значка>
  Устанавливает значок для протокола

SET_TAB_ICON <ID значка> <ID закладки>
  Устанавливает значок для закладки

SET_MENU_ICON <ID значка> <хендл меню>
  Устанавливает значок для пункта меню

SET_BUTTON_ICON <ID значка> <хендл кнопки>
  Устанавливает значок для кнопки

SET_USER_ICON <ID значка> <ID закладки> <ID юзера>
  Устанавливает значок для юзера
